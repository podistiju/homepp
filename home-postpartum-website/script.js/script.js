// ===== TRANSLATION DATA =====
const translations = {
    'en': {
        'home_postpartum': 'Home Postpartum',
        'language': 'Language:',
        'nav_home': 'Home',
        'nav_services': 'Services',
        'nav_areas': 'Service Areas',
        'nav_intake': 'Intake Form',
        'nav_contact': 'Contact',
        'hero_title': 'Professional Postpartum Care at Home',
        'hero_subtitle': 'Comprehensive midwifery and lactation support for new families in the Tri-Cities area as well as Pitt Meadows and Maple Ridge. MSP covered services with home visits for your comfort and convenience.',
        'hero_cta': 'Start Your Care Journey',
        'services_title': 'Our Services',
        'service1_title': 'Full Postpartum Care',
        'service1_item1': '6 weeks of postpartum care covered by MSP',
        'service1_item2': 'No healthcare provider referral needed - self referral accepted',
        'service1_item3': 'Self refer during pregnancy or up to 13 days after birth',
        'service1_item4': 'All visits are home visits throughout the 6 weeks',
        'service1_item5': 'Comprehensive postpartum health monitoring',
        'service1_item6': 'Newborn care and feeding support',
        'service2_title': 'IBCLC Lactation Consulting',
        'service2_item1': 'MSP covered up to 6 weeks (healthcare provider referral required)',
        'service2_item2': 'Service available beyond 6 weeks postpartum (private pay)',
        'service2_item3': 'Self referral accepted for private pay services',
        'service2_item4': 'Breastfeeding support and education',
        'service2_item5': 'Latch assessment and improvement',
        'service2_item6': 'Pumping and milk supply guidance',
        'areas_title': 'Service Areas',
        'intake_title': 'Client Intake Form',
        'intake_intro': 'Please fill out this form to begin your postpartum care journey. All information is confidential and will be sent securely to our team.',
        'form_first_name': 'First Name',
        'form_last_name': 'Last Name',
        'form_phn': 'Personal Health Number',
        'form_dob': 'Date of Birth',
        'form_phone': 'Phone Number',
        'form_email': 'Email Address',
        'form_address': 'Full Address',
        'form_due_date': 'Due Date (if pregnant)',
        'form_delivery_date': 'Delivery Date (if delivered)',
        'form_delivery_info': 'Delivery Information (if applicable)',
        'form_pregnancy_complications': 'Pregnancy Complications',
        'form_health_complications': 'Health Complications or Medical History',
        'form_concerns': 'Current Concerns or Challenges',
        'form_feeding_hopes': 'Hopes for Feeding Baby',
        'form_questions': 'Questions for the Midwife/Lactation Consultant',
        'form_emergency_contact': 'Emergency Contact Name and Phone',
        'form_consent': 'I consent to sharing this information with Home Postpartum for the purpose of providing care.',
        'form_submit': 'Submit Intake Form',
        'contact_title': 'Contact Information',
        'contact_email': 'Email:',
        'contact_fax': 'Fax:',
        'contact_note': 'Serving families in the Tri-Cities area as well as Pitt Meadows and Maple Ridge with compassionate, professional postpartum care',
        'footer_text': '© 2024 Home Postpartum. All rights reserved. Professional midwifery care for your family.'
    },
    'zh-cn': {
        'home_postpartum': '居家产后护理',
        'language': '语言:',
        'nav_home': '首页',
        'nav_services': '服务',
        'nav_areas': '服务区域',
        'nav_intake': '预约表格',
        'nav_contact': '联系我们',
        'hero_title': '专业的居家产后护理',
        'hero_subtitle': '为三城地区以及皮特草原和枫叶岭的新生家庭提供全面的助产和哺乳支持。MSP覆盖的服务，上门访问让您舒适便利。',
        'hero_cta': '开始您的护理之旅',
        'services_title': '我们的服务',
        'service1_title': '完整产后护理',
        'service1_item1': '6周产后护理由MSP承保',
        'service1_item2': '无需医疗提供者转诊-接受自我转诊',
        'service1_item3': '怀孕期间或出生后13天内可自我转诊',
        'service1_item4': '6周内所有访问均为上门访问',
        'service1_item5': '全面的产后健康监测',
        'service1_item6': '新生儿护理和喂养支持',
        'service2_title': 'IBCLC哺乳咨询',
        'service2_item1': 'MSP承保至6周（需要医疗提供者转诊）',
        'service2_item2': '产后6周后可提供服务（私人付费）',
        'service2_item3': '私人付费服务接受自我转诊',
        'service2_item4': '母乳喂养支持和教育',
        'service2_item5': '衔乳评估和改善',
        'service2_item6': '吸奶器使用和母乳供应指导',
        'areas_title': '服务区域',
        'intake_title': '客户预约表格',
        'intake_intro': '请填写此表格开始您的产后护理之旅。所有信息均为保密，将安全发送给我们的团队。',
        'form_first_name': '名字',
        'form_last_name': '姓氏',
        'form_phn': '个人健康号码',
        'form_dob': '出生日期',
        'form_phone': '电话号码',
        'form_email': '电子邮件地址',
        'form_address': '完整地址',
        'form_due_date': '预产期（如果怀孕）',
        'form_delivery_date': '分娩日期（如果已分娩）',
        'form_delivery_info': '分娩信息（如适用）',
        'form_pregnancy_complications': '妊娠并发症',
        'form_health_complications': '健康并发症或病史',
        'form_concerns': '当前担忧或挑战',
        'form_feeding_hopes': '对婴儿喂养的希望',
        'form_questions': '对助产士/哺乳顾问的问题',
        'form_emergency_contact': '紧急联系人姓名和电话',
        'form_consent': '我同意将此信息分享给居家产后护理以提供护理服务。',
        'form_submit': '提交预约表格',
        'contact_title': '联系信息',
        'contact_email': '电子邮件:',
        'contact_fax': '传真:',
        'contact_note': '为三城地区以及皮特草原和枫叶岭的家庭提供充满关爱的专业产后护理',
        'footer_text': '© 2024 居家产后护理。版权所有。为您的家庭提供专业助产护理。'
    },
    'fr': {
        'home_postpartum': 'Soins Postpartum à Domicile',
        'language': 'Langue:',
        'nav_home': 'Accueil',
        'nav_services': 'Services',
        'nav_areas': 'Zones de Service',
        'nav_intake': 'Formulaire d\'Admission',
        'nav_contact': 'Contact',
        'hero_title': 'Soins Postpartum Professionnels à Domicile',
        'hero_subtitle': 'Soutien complet en sage-femme et lactation pour les nouvelles familles dans la région des Tri-Cities ainsi que Pitt Meadows et Maple Ridge. Services couverts par le MSP avec des visites à domicile pour votre confort et commodité.',
        'hero_cta': 'Commencez Votre Parcours de Soins',
        'services_title': 'Nos Services',
        'service1_title': 'Soins Postpartum Complets',
        'service1_item1': '6 semaines de soins postpartum couverts par le MSP',
        'service1_item2': 'Aucune référence de fournisseur de soins requis - auto-référence acceptée',
        'service1_item3': 'Auto-référence pendant la grossesse ou jusqu\'à 13 jours après la naissance',
        'service1_item4': 'Toutes les visites sont des visites à domicile pendant les 6 semaines',
        'service1_item5': 'Surveillance complète de la santé postpartum',
        'service1_item6': 'Soins du nouveau-né et soutien à l\'alimentation',
        'service2_title': 'Consultation en Lactation IBCLC',
        'service2_item1': 'MSP couvré jusqu\'à 6 semaines (référence de fournisseur de soins requise)',
        'service2_item2': 'Service disponible au-delà de 6 semaines postpartum (paiement privé)',
        'service2_item3': 'Auto-référence acceptée pour les services à paiement privé',
        'service2_item4': 'Soutien et éducation à l\'allaitement',
        'service2_item5': 'Évaluation et amélioration de la prise du sein',
        'service2_item6': 'Guide pour le pompage et l\'approvisionnement en lait',
        'areas_title': 'Zones de Service',
        'intake_title': 'Formulaire d\'Admission Client',
        'intake_intro': 'Veuillez remplir ce formulaire pour commencer votre parcours de soins postpartum. Toutes les informations sont confidentielles et seront envoyées en toute sécurité à notre équipe.',
        'form_first_name': 'Prénom',
        'form_last_name': 'Nom de Famille',
        'form_phn': 'Numéro de Santé Personnel',
        'form_dob': 'Date de Naissance',
        'form_phone': 'Numéro de Téléphone',
        'form_email': 'Adresse E-mail',
        'form_address': 'Adresse Complète',
        'form_due_date': 'Date d\'Accouchement Prévue (si enceinte)',
        'form_delivery_date': 'Date d\'Accouchement (si accouchée)',
        'form_delivery_info': 'Informations sur l\'Accouchement (le cas échéant)',
        'form_pregnancy_complications': 'Complications de Grossesse',
        'form_health_complications': 'Complications de Santé ou Antécédents Médicaux',
        'form_concerns': 'Préoccupations ou Défis Actuels',
        'form_feeding_hopes': 'Espoirs pour l\'Alimentation du Bébé',
        'form_questions': 'Questions pour la Sage-femme/Consultante en Lactation',
        'form_emergency_contact': 'Nom et Téléphone du Contact d\'Urgence',
        'form_consent': 'J\'accepte de partager ces informations avec Soins Postpartum à Domicile dans le but de fournir des soins.',
        'form_submit': 'Soumettre le Formulaire d\'Admission',
        'contact_title': 'Informations de Contact',
        'contact_email': 'E-mail:',
        'contact_fax': 'Télécopieur:',
        'contact_note': 'Au service des familles dans la région des Tri-Cities ainsi que Pitt Meadows et Maple Ridge avec des soins postpartum professionnels et compatissants',
        'footer_text': '© 2024 Soins Postpartum à Domicile. Tous droits réservés. Soins de sage-femme professionnels pour votre famille.'
    },
    'es': {
        'home_postpartum': 'Cuidado Postparto en Casa',
        'language': 'Idioma:',
        'nav_home': 'Inicio',
        'nav_services': 'Servicios',
        'nav_areas': 'Áreas de Servicio',
        'nav_intake': 'Formulario de Admisión',
        'nav_contact': 'Contacto',
        'hero_title': 'Cuidado Postparto Profesional en Casa',
        'hero_subtitle': 'Apoyo integral de partería y lactancia para nuevas familias en el área de Tri-Cities así como Pitt Meadows y Maple Ridge. Servicios cubiertos por MSP con visitas domiciliarias para su comodidad y conveniencia.',
        'hero_cta': 'Comience Su Viaje de Cuidado',
        'services_title': 'Nuestros Servicios',
        'service1_title': 'Cuidado Postparto Completo',
        'service1_item1': '6 semanas de cuidado postparto cubierto por MSP',
        'service1_item2': 'No se necesita referencia de proveedor de salud - se acepta auto-referencia',
        'service1_item3': 'Auto-referirse durante el embarazo o hasta 13 días después del nacimiento',
        'service1_item4': 'Todas las visitas son domiciliarias durante las 6 semanas',
        'service1_item5': 'Monitoreo integral de salud postparto',
        'service1_item6': 'Cuidado del recién nacido y apoyo de alimentación',
        'service2_title': 'Consultoría de Lactancia IBCLC',
        'service2_item1': 'MSP cubierto hasta 6 semanas (se requiere referencia de proveedor de salud)',
        'service2_item2': 'Servicio disponible más allá de 6 semanas postparto (pago privado)',
        'service2_item3': 'Auto-referencia aceptada para servicios de pago privado',
        'service2_item4': 'Apoyo y educación de lactancia materna',
        'service2_item5': 'Evaluación y mejora del agarre',
        'service2_item6': 'Guía de extracción y suministro de leche',
        'areas_title': 'Áreas de Servicio',
        'intake_title': 'Formulario de Admisión del Cliente',
        'intake_intro': 'Por favor complete este formulario para comenzar su viaje de cuidado postparto. Toda la información es confidencial y será enviada de forma segura a nuestro equipo.',
        'form_first_name': 'Nombre',
        'form_last_name': 'Apellido',
        'form_phn': 'Número de Salud Personal',
        'form_dob': 'Fecha de Nacimiento',
        'form_phone': 'Número de Teléfono',
        'form_email': 'Dirección de Correo Electrónico',
        'form_address': 'Dirección Completa',
        'form_due_date': 'Fecha de Parto (si está embarazada)',
        'form_delivery_date': 'Fecha de Parto (si dio a luz)',
        'form_delivery_info': 'Información del Parto (si aplica)',
        'form_pregnancy_complications': 'Complicaciones del Embarazo',
        'form_health_complications': 'Complicaciones de Salud o Historial Médico',
        'form_concerns': 'Preocupaciones o Desafíos Actuales',
        'form_feeding_hopes': 'Esperanzas para Alimentar al Bebé',
        'form_questions': 'Preguntas para la Partera/Consultora de Lactancia',
        'form_emergency_contact': 'Nombre y Teléfono de Contacto de Emergencia',
        'form_consent': 'Consiento compartir esta información con Cuidado Postparto en Casa con el propósito de brindar atención.',
        'form_submit': 'Enviar Formulario de Admisión',
        'contact_title': 'Información de Contacto',
        'contact_email': 'Correo:',
        'contact_fax': 'Fax:',
        'contact_note': 'Sirviendo a familias en el área de Tri-Cities así como Pitt Meadows y Maple Ridge con cuidado postparto profesional y compasivo',
        'footer_text': '© 2024 Cuidado Postparto en Casa. Todos los derechos reservados. Cuidado profesional de partería para su familia.'
    }
    // Additional languages can be added here following the same pattern
};

// ===== LANGUAGE FUNCTIONALITY =====
function changeLanguage(language) {
    try {
        // Store selected language in browser storage for persistence
        localStorage.setItem('selectedLanguage', language);
        
        // Get translation data for selected language
        const langData = translations[language];
        
        if (!langData) {
            console.warn(`Translation not found for language: ${language}`);
            return;
        }

        // Find all elements with data-translate attribute
        const elementsToTranslate = document.querySelectorAll('[data-translate]');
        
        // Update each element's text content
        elementsToTranslate.forEach(element => {
            const key = element.getAttribute('data-translate');
            const translation = langData[key];
            
            if (translation) {
                element.textContent = translation;
            } else {
                console.warn(`Translation key not found: ${key} for language: ${language}`);
            }
        });

        // Update HTML lang attribute for accessibility
        document.documentElement.lang = language;
        
        // Update placeholders for form fields
        updateFormPlaceholders(language);
        
    } catch (error) {
        console.error('Error changing language:', error);
    }
}

// Update form field placeholders based on language
function updateFormPlaceholders(language) {
    const placeholderMappings = {
        'en': {
            'deliveryInfo': 'Hospital, birth type, complications, etc.',
            'feedingHopes': 'Breastfeeding goals, formula feeding, combination feeding, etc.'
        },
        'zh-cn': {
            'deliveryInfo': '医院、分娩类型、并发症等',
            'feedingHopes': '母乳喂养目标、配方奶喂养、混合喂养等'
        },
        'fr': {
            'deliveryInfo': 'Hôpital, type d\'accouchement, complications, etc.',
            'feedingHopes': 'Objectifs d\'allaitement, alimentation au biberon, alimentation mixte, etc.'
        },
        'es': {
            'deliveryInfo': 'Hospital, tipo de parto, complicaciones, etc.',
            'feedingHopes': 'Objetivos de lactancia materna, alimentación con fórmula, alimentación combinada, etc.'
        }
    };

    const placeholders = placeholderMappings[language];
    if (placeholders) {
        Object.keys(placeholders).forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.placeholder = placeholders[fieldId];
            }
        });
    }
}

// ===== FORM FUNCTIONALITY =====
// Form validation and submission handling
function initializeForm() {
    const form = document.getElementById('intakeForm');
    const submitButton = document.querySelector('.submit-btn');
    
    if (!form || !submitButton) {
        console.error('Form or submit button not found');
        return;
    }

    // Add form validation
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Validate required fields
        if (!validateForm()) {
            return;
        }
        
        // Show loading state
        showLoadingState(submitButton);
        
        // Submit form
        submitForm(form, submitButton);
    });

    // Add real-time validation
    addRealTimeValidation();
}

// Form validation function
function validateForm() {
    const requiredFields = [
        'firstName', 'lastName', 'phn', 'dob', 
        'phone', 'email', 'address', 'consent'
    ];
    
    let isValid = true;
    const errors = [];

    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field) return;

        // Remove previous error styling
        field.classList.remove('error');
        
        // Check if field is empty
        if (fieldId === 'consent') {
            if (!field.checked) {
                field.classList.add('error');
                errors.push('You must consent to sharing information');
                isValid = false;
            }
        } else {
            if (!field.value.trim()) {
                field.classList.add('error');
                errors.push(`${field.previousElementSibling.textContent} is required`);
                isValid = false;
            }
        }
    });

    // Validate email format
    const emailField = document.getElementById('email');
    if (emailField && emailField.value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailField.value)) {
            emailField.classList.add('error');
            errors.push('Please enter a valid email address');
            isValid = false;
        }
    }

    // Validate phone number (basic validation)
    const phoneField = document.getElementById('phone');
    if (phoneField && phoneField.value) {
        const phoneRegex = /^[\d\s\-\+\(\)]{10,}$/;
        if (!phoneRegex.test(phoneField.value)) {
            phoneField.classList.add('error');
            errors.push('Please enter a valid phone number');
            isValid = false;
        }
    }

    // Show errors if any
    if (!isValid) {
        showErrors(errors);
        // Scroll to first error
        const firstError = document.querySelector('.error');
        if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    return isValid;
}

// Add real-time validation to form fields
function addRealTimeValidation() {
    const formFields = document.querySelectorAll('#intakeForm input, #intakeForm textarea, #intakeForm select');
    
    formFields.forEach(field => {
        field.addEventListener('blur', function() {
            validateField(this);
        });
        
        field.addEventListener('input', function() {
            // Remove error styling when user starts typing
            this.classList.remove('error');
            clearErrors();
        });
    });
}

// Validate individual field
function validateField(field) {
    field.classList.remove('error');
    
    // Check if required field is empty
    if (field.hasAttribute('required') && !field.value.trim()) {
        field.classList.add('error');
        return false;
    }
    
    // Email validation
    if (field.type === 'email' && field.value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(field.value)) {
            field.classList.add('error');
            return false;
        }
    }
    
    return true;
}

// Show loading state on submit button
function showLoadingState(button) {
    button.disabled = true;
    button.classList.add('loading');
    button.textContent = 'Submitting...';
}

// Hide loading state
function hideLoadingState(button) {
    button.disabled = false;
    button.classList.remove('loading');
    
    // Get current language to set correct text
    const currentLang = localStorage.getItem('selectedLanguage') || 'en';
    const submitText = translations[currentLang]['form_submit'] || 'Submit Intake Form';
    button.textContent = submitText;
}

// Submit form via AJAX
function submitForm(form, button) {
    const formData = new FormData(form);
    
    fetch('process-form.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        hideLoadingState(button);
        
        if (data.success) {
            showSuccessMessage();
            form.reset();
        } else {
            showErrors([data.message || 'An error occurred. Please try again.']);
        }
    })
    .catch(error => {
        hideLoadingState(button);
        console.error('Form submission error:', error);
        showErrors(['Network error. Please check your connection and try again.']);
    });
}

// Show success message
function showSuccessMessage() {
    const message = document.createElement('div');
    message.className = 'success-message';
    message.innerHTML = `
        <div style="background: #d1fae5; border: 2px solid #10b981; color: #065f46; padding: 1rem; border-radius: 10px; margin: 1rem 0; text-align: center;">
            <strong>Form submitted successfully!</strong><br>
            Thank you for your submission. We will contact you within 24 hours.
        </div>
    `;
    
    const form = document.getElementById('intakeForm');
    form.parentNode.insertBefore(message, form);
    
    // Scroll to success message
    message.scrollIntoView({ behavior: 'smooth', block: 'center' });
    
    // Remove message after 5 seconds
    setTimeout(() => {
        message.remove();
    }, 5000);
}

// Show error messages
function showErrors(errors) {
    clearErrors();
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-messages';
    errorDiv.innerHTML = `
        <div style="background: #fee2e2; border: 2px solid #ef4444; color: #991b1b; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
            <strong>Please correct the following errors:</strong>
            <ul style="margin: 0.5rem 0 0 1rem; padding: 0;">
                ${errors.map(error => `<li>${error}</li>`).join('')}
            </ul>
        </div>
    `;
    
    const form = document.getElementById('intakeForm');
    form.parentNode.insertBefore(errorDiv, form);
}

// Clear error messages
function clearErrors() {
    const existingErrors = document.querySelectorAll('.error-messages');
    existingErrors.forEach(error => error.remove());
}

// ===== SMOOTH SCROLLING =====
function initializeSmoothScrolling() {
    // Add smooth scrolling to navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// ===== ACCESSIBILITY FEATURES =====
function initializeAccessibility() {
    // Add keyboard navigation for custom elements
    document.addEventListener('keydown', function(e) {
        // Enter key on buttons
        if (e.key === 'Enter' && e.target.classList.contains('cta-button')) {
            e.target.click();
        }
    });
    
    // Announce page changes to screen readers
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1 && (node.classList.contains('success-message') || node.classList.contains('error-messages'))) {
                        // Announce to screen readers
                        node.setAttribute('role', 'alert');
                        node.setAttribute('aria-live', 'polite');
                    }
                });
            }
        });
    });
    
    observer.observe(document.body, { childList: true, subtree: true });
}

// ===== INITIALIZATION =====
// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    try {
        // Load saved language
        const savedLanguage = localStorage.getItem('selectedLanguage');
        if (savedLanguage && translations[savedLanguage]) {
            document.getElementById('language').value = savedLanguage;
            changeLanguage(savedLanguage);
        }
        
        // Initialize all features
        initializeForm();
        initializeSmoothScrolling();
        initializeAccessibility();
        
        console.log('Website initialized successfully');
        
    } catch (error) {
        console.error('Initialization error:', error);
    }
});

// ===== UTILITY FUNCTIONS =====
// Add CSS for error states if not defined in CSS
function addErrorStyles() {
    if (!document.getElementById('error-styles')) {
        const style = document.createElement('style');
        style.id = 'error-styles';
        style.textContent = `
            .form-group input.error,
            .form-group textarea.error,
            .form-group select.error {
                border-color: #ef4444 !important;
                box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
            }
            
            .success-message,
            .error-messages {
                animation: slideIn 0.3s ease-out;
            }
            
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
    }
}

// Performance optimization: Debounce function for input validation
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Add error styles when script loads
addErrorStyles();